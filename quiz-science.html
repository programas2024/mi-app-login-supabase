
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ciencia Extrema</title>
     <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* Agrega aquí tus estilos CSS. */
        /* Por ejemplo: */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #e0e0e0;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .option-btn:hover {
            background-color: #d0d0d0;
        }
        .option-btn.correct {
            background-color: #4caf50;
            color: white;
        }
        .option-btn.incorrect {
            background-color: #f44336;
            color: white;
        }
        .feedback-container {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .correct-feedback {
            background-color: #e8f5e9;
            color: #4caf50;
        }
        .incorrect-feedback {
            background-color: #ffebee;
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ciencia Extrema</h1>
        <div id="quiz-container">
            <h2 id="question-text"></h2>
            <div id="options-container"></div>
            <p>Pregunta: <span id="question-number"></span> de 8</p>
            <p>Correctas: <span id="correct-count">0</span> | Incorrectas: <span id="incorrect-count">0</span></p>
            <div id="timer-bar-container">
                <div id="timer-bar"></div>
            </div>
            <p id="timer-text"></p>
            <div id="feedback-container" style="display:none;"></div>
            <button id="fifty-fifty-booster">50/50</button>
            <button id="time-booster">+30s</button>
            <button id="restart-btn" style="display:none;">Reiniciar</button>
        </div>
    </div>

   

<script>
    // Todo tu código se ejecuta dentro de este evento.
    // Esto asegura que los scripts de Supabase y SweetAlert2 ya estén cargados.
    document.addEventListener('DOMContentLoaded', function() {
        
        // Tus preguntas de ciencia deben ir aquí
        const allScienceQuestions = [
            {
                question: "¿Cuál es el planeta más grande del sistema solar?",
                options: ["Tierra", "Júpiter", "Marte", "Saturno"],
                answer: 1,
                explanation: "Júpiter es el planeta más grande del sistema solar."
            },
            {
                question: "¿Qué gas es el más abundante en la atmósfera de la Tierra?",
                options: ["Oxígeno", "Dióxido de carbono", "Nitrógeno", "Argón"],
                answer: 2,
                explanation: "El nitrógeno constituye aproximadamente el 78% de la atmósfera terrestre."
            },
            {
                question: "¿Cuál es el elemento químico con el símbolo 'Fe'?",
                options: ["Oro", "Plata", "Hierro", "Cobre"],
                answer: 2,
                explanation: "El símbolo químico 'Fe' corresponde al Hierro."
            },
            {
                question: "¿A qué grupo de animales pertenece la ballena?",
                options: ["Pez", "Reptil", "Mamífero", "Anfibio"],
                answer: 2,
                explanation: "Aunque vive en el agua, la ballena es un mamífero marino."
            },
            {
                question: "¿Qué científico formuló la teoría de la relatividad?",
                options: ["Isaac Newton", "Galileo Galilei", "Albert Einstein", "Stephen Hawking"],
                answer: 2,
                explanation: "Albert Einstein fue quien formuló la famosa teoría de la relatividad."
            },
            {
                question: "¿Cuál es el hueso más largo del cuerpo humano?",
                options: ["Fémur", "Húmero", "Tibia", "Peroné"],
                answer: 0,
                explanation: "El fémur, ubicado en el muslo, es el hueso más largo."
            },
            {
                question: "¿Cuál es la velocidad de la luz en el vacío?",
                options: ["300.000 km/s", "150.000 km/s", "400.000 km/s", "250.000 km/s"],
                answer: 0,
                explanation: "La velocidad de la luz es aproximadamente 300.000 kilómetros por segundo."
            },
            {
                question: "¿Qué parte de la célula produce energía?",
                options: ["Núcleo", "Mitocondria", "Ribosoma", "Vacuola"],
                answer: 1,
                explanation: "Las mitocondrias son conocidas como las 'centrales energéticas' de la célula."
            }
        ];

        // Variables del juego MEJORADAS
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let timer;
        let timeLeft = 120;
        let gameActive = true;
        let fiftyFiftyUsed = false;
        let timeBoostUsed = false;
        let usedQuestions = [];
        let selectedQuestions = [];

        // Elementos del DOM
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const questionNumber = document.getElementById('question-number');
        const correctCount = document.getElementById('correct-count');
        const incorrectCount = document.getElementById('incorrect-count');
        const timerBar = document.getElementById('timer-bar');
        const timerText = document.getElementById('timer-text');
        const feedbackContainer = document.getElementById('feedback-container');
        const resultContainer = document.getElementById('result-container');
        const restartBtn = document.getElementById('restart-btn');
        const fiftyFiftyBooster = document.getElementById('fifty-fifty-booster');
        const timeBooster = document.getElementById('time-booster');

         // Configuración de Supabase
        const SUPABASE_URL = 'https://fesrphtabjohxcklbosh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlc3JwaHRhYmpvaHhja2xib3NoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMjQ0ODAsImV4cCI6MjA2ODYwMDQ4MH0.S8EJGetv7v9OWfiUCbxvoza1e8yUBVojyWvYCrR5nLo';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      
        async function updatePearls(pearlsToAdd) {
            if (!supabase) {
                console.log('Supabase no está disponible');
                return null;
            }
            // ... (el resto de la función updatePearls es el mismo) ...
            try {
                const { data: { user }, error: authError } = await supabase.auth.getUser();
                
                if (authError || !user) {
                    console.log('Usuario no autenticado');
                    return null;
                }
                
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('perla')
                    .eq('id', user.id)
                    .single();
                
                if (error) throw error;
                
                const currentPearls = profile.perla || 0;
                const newTotal = currentPearls + pearlsToAdd;
                
                const { error: updateError } = await supabase
                    .from('profiles')
                    .update({ perla: newTotal })
                    .eq('id', user.id);
                
                if (updateError) throw updateError;
                
                return newTotal;
            } catch (error) {
                console.error('Error actualizando perlas:', error);
                return null;
            }
        }

        // ... (El resto de tus funciones de juego, como initGame, showQuestion, etc., va aquí) ...

        function initGame() {
            const availableQuestions = allScienceQuestions.filter(q => !usedQuestions.includes(q.question));
            
            if (availableQuestions.length < 8) {
                usedQuestions = [];
            }
            
            selectedQuestions = [...availableQuestions]
                .sort(() => 0.5 - Math.random())
                .slice(0, 8);
            
            selectedQuestions.forEach(q => usedQuestions.push(q.question));
            
            currentQuestionIndex = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            timeLeft = 120;
            gameActive = true;
            fiftyFiftyUsed = false;
            timeBoostUsed = false;
            
            updateStats();
            startTimer();
            showQuestion();
            
            if (resultContainer) resultContainer.style.display = 'none';
            if (feedbackContainer) feedbackContainer.style.display = 'none';
            
            if (fiftyFiftyBooster) {
                fiftyFiftyBooster.style.opacity = '1';
                fiftyFiftyBooster.style.height = 'auto';
                fiftyFiftyBooster.style.padding = '15px 25px';
                fiftyFiftyBooster.style.margin = '0';
                fiftyFiftyBooster.disabled = false;
            }
            
            if (timeBooster) {
                timeBooster.style.opacity = '1';
                timeBooster.style.height = 'auto';
                timeBooster.style.padding = '15px 25px';
                timeBooster.style.margin = '0';
                timeBooster.disabled = false;
            }
            
            createEmoji('🚀', 5);
            createEmoji('🔬', 5);
        }

        function showQuestion() {
            if (currentQuestionIndex >= selectedQuestions.length) {
                endGame();
                return;
            }
            
            const question = selectedQuestions[currentQuestionIndex];
            questionNumber.textContent = currentQuestionIndex + 1;
            questionText.textContent = question.question;
            
            questionText.style.animation = 'none';
            void questionText.offsetWidth; 
            questionText.style.animation = 'fadeIn 0.5s';
            
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.dataset.letter = String.fromCharCode(65 + index);
                optionBtn.textContent = option;
                optionBtn.onclick = () => selectOption(index);
                
                optionBtn.style.animation = `fadeIn 0.3s ${index * 0.1}s forwards`;
                optionBtn.style.opacity = '0';
                
                optionsContainer.appendChild(optionBtn);
            });
            
            if (feedbackContainer) feedbackContainer.style.display = 'none';
            fiftyFiftyUsed = false;
            timeBoostUsed = false;
            
            if (Math.random() > 0.7) {
                createEmoji('🤔', 1);
            }
        }
        
        function selectOption(selectedIndex) {
            if (!gameActive) return;
            
            const question = selectedQuestions[currentQuestionIndex];
            const optionButtons = document.querySelectorAll('.option-btn');
            
            optionButtons.forEach(btn => {
                btn.classList.add('disabled');
                btn.onclick = null;
            });
            
            optionButtons[question.answer].classList.add('correct');
            
            if (selectedIndex === question.answer) {
                optionButtons[selectedIndex].classList.add('correct');
                correctAnswers++;
                
                createConfetti(20);
                createEmoji('🎉', 3);
                createEmoji('👏', 3);
                playSound('correct');
                
                showFeedback('¡BIEN HECHO! 🎯', true);
            } else {
                optionButtons[selectedIndex].classList.add('incorrect');
                incorrectAnswers++;
                
                createEmoji('💥', 2);
                playSound('wrong');
                
                showFeedback(`¡Ups! ${question.explanation}`, false);
            }
            
            updateStats();
            
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < selectedQuestions.length) {
                    showQuestion();
                } else {
                    endGame();
                }
            }, 2000);
        }

        function showFeedback(message, isCorrect) {
            if (!feedbackContainer) return;
            feedbackContainer.textContent = message;
            feedbackContainer.className = 'feedback-container ' + (isCorrect ? 'correct-feedback' : 'incorrect-feedback');
            feedbackContainer.style.display = 'block';
            
            if (!isCorrect) {
                feedbackContainer.style.animation = 'shake 0.5s';
            }
        }

        function updateStats() {
            if (correctCount) correctCount.textContent = correctAnswers;
            if (incorrectCount) incorrectCount.textContent = incorrectAnswers;
            
            if (correctCount && correctAnswers > parseInt(correctCount.dataset.prev || 0)) {
                correctCount.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    correctCount.style.transform = 'scale(1)';
                }, 300);
            }
            if (correctCount) correctCount.dataset.prev = correctAnswers;
        }

        function startTimer() {
            clearInterval(timer);
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            if (!timerText || !timerBar) return;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerText.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            const percentage = (timeLeft / 120) * 100;
            timerBar.style.width = `${percentage}%`;
            
            if (timeLeft <= 10) {
                timerBar.style.background = 'linear-gradient(90deg, #ff416c, #ff4b2b)';
                timerText.style.color = '#ff416c';
                timerText.style.animation = 'pulse 0.5s infinite alternate';
                
                if (timeLeft <= 5 && timeLeft > 0) {
                    createEmoji('⏰', 1);
                    timerText.style.fontWeight = 'bold';
                }
            } else if (timeLeft <= 30) {
                timerBar.style.background = 'linear-gradient(90deg, #ff8a00, #ff416c)';
                timerText.style.color = '#ff8a00';
                timerText.style.animation = 'none';
            } else if (timeLeft <= 60) {
                timerBar.style.background = 'linear-gradient(90deg, #ff8a00, #e52e71)';
                timerText.style.color = '#ff8a00';
            } else {
                timerBar.style.background = 'linear-gradient(90deg, #ff8a00, #ff8a00)';
                timerText.style.color = '#ff8a00';
                timerText.style.animation = 'none';
            }
        }
        
        function timeUp() {
            gameActive = false;
            createEmoji('⌛', 3);
            playSound('timeup');
            endGame();
        }

        async function endGame() {
            gameActive = false;
            clearInterval(timer);
            
            const totalQuestions = selectedQuestions.length;
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            let title, icon, imageUrl, color, message, pearlsToAdd = 0;
            
            if (percentage >= 90) {
                title = "¡ERES UN GENIO! 🌟";
                icon = "success";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/7339/7339724.png";
                color = "#00b09b";
                message = `¡Increíble! Obtuviste <strong>${correctAnswers} de ${totalQuestions}</strong> respuestas correctas.<br><br>¡Tu conocimiento científico es asombroso!`;
                pearlsToAdd = 5;
            } else if (percentage >= 70) {
                title = "¡EXCELENTE TRABAJO! 👍";
                icon = "success";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/10646/10646252.png";
                color = "#2575fc";
                message = `¡Muy bien! Acertaste <strong>${correctAnswers} de ${totalQuestions}</strong>.<br><br>¡Estás en el camino para convertirte en un científico destacado!`;
                pearlsToAdd = 4;
            } else if (percentage >= 50) {
                title = "¡BUEN INTENTO! 😊";
                icon = "info";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/3032/3032495.png";
                color = "#ff8a00";
                message = `Obtuviste <strong>${correctAnswers} de ${totalQuestions}</strong> respuestas correctas.<br><br>¡Sigue aprendiendo y mejorarás!`;
                pearlsToAdd = 3;
            } else {
                title = "¡SIGUE PRACTICANDO! 📚";
                icon = "info";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/8461/8461625.png";
                color = "#ff416c";
                message = `Acertaste <strong>${correctAnswers} de ${totalQuestions}</strong>.<br><br>¡La ciencia es divertida! Sigue intentándolo.`;
                pearlsToAdd = 1;
            }
            
            const swalOptions = {
                title: title,
                html: `
                    <div style="text-align: center;">
                        <img src="${imageUrl}" style="height: 150px; margin: 10px 0; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <div style="margin: 20px 0; font-size: 1.2em;">
                            ${message}
                        </div>
                        <div style="background: rgba(0,0,0,0.05); border-radius: 10px; padding: 15px; margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="font-weight: bold;">✅ Correctas:</span>
                                <span style="color: #00b09b; font-weight: bold;">${correctAnswers}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-weight: bold;">❌ Incorrectas:</span>
                                <span style="color: #ff416c; font-weight: bold;">${incorrectAnswers}</span>
                            </div>
                            <div style="margin-top: 15px; height: 10px; background: #f5f5f5; border-radius: 5px; overflow: hidden;">
                                <div style="height: 100%; width: ${percentage}%; background: linear-gradient(90deg, ${color}, ${color}); border-radius: 5px;"></div>
                            </div>
                            <div style="margin-top: 5px; font-weight: bold; color: ${color};">${percentage}% de aciertos</div>
                        </div>
                    </div>
                `,
                icon: icon,
                confirmButtonText: '¡Jugar de nuevo!',
                confirmButtonColor: '#6a11cb',
                background: '#ffffff',
                width: '650px',
                customClass: {
                    popup: 'animated bounceIn',
                    title: 'swal-title-custom'
                },
                willOpen: () => {
                    if (percentage >= 80) {
                        createConfetti(50);
                        createEmoji('🎉', 10);
                        createEmoji('🏆', 10);
                        playSound('win');
                    }
                }
            };
            
            try {
                const newPearlCount = await updatePearls(pearlsToAdd);
                
                if (newPearlCount !== null) {
                    swalOptions.html += `
                        <div style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <span style="font-weight: bold;">¡Has ganado:</span>
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 1.5em; margin-right: 5px;">${pearlsToAdd}</span>
                                    <svg width="24" height="24" viewBox="0 0 24 24" style="fill: #8D6E63;">
                                        <circle cx="12" cy="12" r="10" fill="#f5f5f5" stroke="#8D6E63" stroke-width="1"/>
                                        <path d="M12 3a9 9 0 0 1 0 18" stroke="white" stroke-width="1.5" opacity="0.7"/>
                                    </svg>
                                </div>
                            </div>
                            <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                                Total acumulado: <strong>${newPearlCount} perla${newPearlCount !== 1 ? 's' : ''}</strong>
                            </div>
                        </div>
                    `;
                    
                    if (pearlsToAdd > 0) {
                        playSound('coin');
                    }
                }
            } catch (error) {
                console.error('Error al procesar recompensas:', error);
            }
            
            Swal.fire(swalOptions).then((result) => {
                if (result.isConfirmed) {
                    initGame();
                }
            });
        }
        
        if (fiftyFiftyBooster) {
            fiftyFiftyBooster.onclick = function() {
                if (fiftyFiftyUsed || !gameActive) return;
                
                const question = selectedQuestions[currentQuestionIndex];
                const optionButtons = document.querySelectorAll('.option-btn');
                let optionsToHide = [];
                
                for (let i = 0; i < question.options.length; i++) {
                    if (i !== question.answer && optionsToHide.length < 2) {
                        optionsToHide.push(i);
                    }
                }
                
                optionsToHide.forEach(index => {
                    optionButtons[index].style.animation = 'fadeOut 0.3s forwards';
                    setTimeout(() => {
                        optionButtons[index].classList.add('hidden-option');
                    }, 300);
                });
                
                fiftyFiftyUsed = true;
                
                this.style.opacity = '0';
                this.style.height = '0';
                this.style.padding = '0';
                this.style.margin = '0';
                setTimeout(() => {
                    this.disabled = true;
                }, 300);
                
                playSound('booster');
                createEmoji('✨', 2);
                
                Swal.fire({
                    title: '¡POTENCIADOR ACTIVADO!',
                    html: '<div style="font-size: 1.2em;">Se eliminaron <strong>2 respuestas incorrectas</strong> 🎯</div>',
                    icon: 'info',
                    timer: 1500,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    background: '#ffffff',
                    willOpen: () => {
                        createConfetti(10);
                    }
                });
            };
        }

        if (timeBooster) {
            timeBooster.onclick = function() {
                if (timeBoostUsed || !gameActive) return;
                
                timeLeft += 30;
                updateTimerDisplay();
                timeBoostUsed = true;
                
                this.style.opacity = '0';
                this.style.height = '0';
                this.style.padding = '0';
                this.style.margin = '0';
                setTimeout(() => {
                    this.disabled = true;
                }, 300);
                
                createEmoji('⏱️', 2);
                createEmoji('➕', 2);
                playSound('booster');
                
                Swal.fire({
                    title: '¡TIEMPO EXTRA!',
                    html: '<div style="font-size: 1.2em;">+30 segundos añadidos ⏳</div>',
                    icon: 'info',
                    timer: 1500,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    background: '#ffffff'
                });
            };
        }

        function createConfetti(count = 20, isTimeUp = false) {
            const colors = ['#6a11cb', '#2575fc', '#00b09b', '#ff8a00', '#ff416c', '#8e2de2'];
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = confetti.style.width;
                
                if (isTimeUp) {
                    confetti.style.animation = `confettiFall 3s linear ${i * 0.1}s forwards`;
                } else {
                    confetti.style.animation = `confettiFall 5s linear ${i * 0.1}s forwards`;
                }
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        function createEmoji(emoji, count = 1) {
            for (let i = 0; i < count; i++) {
                const emojiElement = document.createElement('div');
                emojiElement.className = 'emoji-float';
                emojiElement.textContent = emoji;
                emojiElement.style.left = `${Math.random() * 80 + 10}%`;
                emojiElement.style.top = `${Math.random() * 50 + 50}%`;
                emojiElement.style.fontSize = `${Math.random() * 2 + 1.5}em`;
                emojiElement.style.animationDuration = `${Math.random() * 3 + 2}s`;
                
                document.body.appendChild(emojiElement);
                
                setTimeout(() => {
                    emojiElement.remove();
                }, 4000);
            }
        }

        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                let frequency, duration;
                
                switch(type) {
                    case 'correct':
                        frequency = 880;
                        duration = 0.3;
                        break;
                    case 'wrong':
                        frequency = 220;
                        duration = 0.5;
                        break;
                    case 'booster':
                        frequency = 523.25;
                        duration = 0.2;
                        break;
                    case 'timeup':
                        frequency = 349.23;
                        duration = 0.5;
                        break;
                    case 'win':
                        playNotes([784, 659, 523, 659, 784, 880], [0, 0.1, 0.2, 0.3, 0.4, 0.5]);
                        return;
                    case 'coin':
                        playNotes([659, 784, 880], [0, 0.1, 0.2]);
                        return;
                    default:
                        frequency = 440;
                        duration = 0.1;
                }
                
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + duration);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Error de audio:", e);
            }
        }

        function playNotes(notes, times) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            notes.forEach((note, i) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(note, audioContext.currentTime + times[i]);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + times[i]);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + times[i] + 0.2);
                
                oscillator.start(audioContext.currentTime + times[i]);
                oscillator.stop(audioContext.currentTime + times[i] + 0.2);
            });
        }

        if (restartBtn) {
            restartBtn.onclick = function() {
                createEmoji('🔄', 3);
                initGame();
            };
        }

        // Iniciar juego con SweetAlert2 al cargar la página
        setTimeout(() => {
            Swal.fire({
                title: '¡BIENVENIDO A CIENCIA EXTREMA!',
                html: `
                    <div style="font-size: 1.1em;">
                        <p>Responde preguntas científicas antes de que se acabe el tiempo.</p>
                        <p>¡Usa los potenciadores para ayudarte!</p>
                    </div>
                    <img src="https://cdn-icons-png.flaticon.com/128/6747/6747064.png" style="height: 120px; margin: 15px 0;">
                `,
                confirmButtonText: '¡Comenzar!',
                confirmButtonColor: '#6a11cb',
                background: '#ffffff',
                showCancelButton: false,
                customClass: {
                    popup: 'animated bounceIn'
                },
                willOpen: () => {
                    createConfetti(20);
                }
            }).then(() => {
                initGame();
            });
        }, 500);

    }); // Fin de document.addEventListener('DOMContentLoaded')
</script>
</body>
</html>
