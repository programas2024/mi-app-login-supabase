

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pelicula Extrema</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --correct-color: #00b09b;
            --incorrect-color: #ff416c;
            --timer-color: #ff8a00;
            --boost-color: #8e2de2;
            --text-light: #ffffff;
            --text-dark: #333333;
            --bg-light: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: #ffffff;
            --neon-shadow: 0 0 10px #2575fc, 0 0 20px #2575fc, 0 0 30px #2575fc;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: var(--bg-light);
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }
        .quiz-container {
            background-color: var(--card-bg);
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 800px;
            padding: 40px;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            border: 3px solid rgba(106, 17, 203, 0.2);
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from {
                box-shadow: 0 0 20px rgba(106, 17, 203, 0.3);
            }
            to {
                box-shadow: 0 0 30px rgba(37, 117, 252, 0.5);
            }
        }
        .header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .back-dashboard {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.3);
            text-decoration: none;
        }
        .back-dashboard:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(106, 17, 203, 0.4);
        }
        .quiz-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        .quiz-header h1 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            display: inline-block;
        }
        .quiz-header h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }
        .quiz-header p {
            color: #666;
            font-size: 1.2em;
            max-width: 600px;
            margin: 0 auto;
        }
        .stats-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            background: rgba(106, 17, 203, 0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        .stats-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
        }
        .stat-box {
            text-align: center;
            flex: 1;
            padding: 10px;
            position: relative;
        }
        .stat-box h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            background: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .correct .stat-value {
            color: var(--correct-color);
            border: 3px solid var(--correct-color);
            animation: pulseCorrect 2s infinite;
        }
        .incorrect .stat-value {
            color: var(--incorrect-color);
            border: 3px solid var(--incorrect-color);
        }
        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .timer-container {
            width: 100%;
            background-color: #f5f5f5;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            height: 20px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--timer-color), #ff8a00);
            width: 100%;
            transition: width 1s linear;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        .timer-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.1) 100%);
            animation: shine 2s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .timer-text {
            text-align: center;
            font-weight: 700;
            margin-top: 10px;
            color: var(--timer-color);
            font-size: 1.2em;
            text-shadow: 0 0 5px rgba(255, 138, 0, 0.3);
        }
        .question-container {
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }
        .question-number {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-weight: 700;
            font-size: 1.4em;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
            border: 3px solid white;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .question-text {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 30px;
            line-height: 1.4;
            color: var(--text-dark);
            padding: 0 10px;
            position: relative;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--primary-color);
        }
        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .option-btn {
            background-color: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 18px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: left;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .option-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-color);
        }
        .option-btn::before {
            content: attr(data-letter);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            font-weight: 700;
            font-size: 1.2em;
            box-shadow: 0 3px 10px rgba(106, 17, 203, 0.3);
        }
        .option-btn.correct {
            background-color: rgba(0, 176, 155, 0.1);
            border-color: var(--correct-color);
            color: var(--correct-color);
            animation: correctPulse 0.5s;
        }
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .option-btn.correct::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 20px;
            color: var(--correct-color);
            font-size: 1.5em;
        }
        .option-btn.incorrect {
            background-color: rgba(255, 65, 108, 0.1);
            border-color: var(--incorrect-color);
            color: var(--incorrect-color);
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .option-btn.incorrect::after {
            content: '\f00d';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 20px;
            color: var(--incorrect-color);
            font-size: 1.5em;
        }
        .option-btn.disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .option-btn.hidden-option {
            display: none;
        }
        .boosters-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        .booster-btn {
            background: linear-gradient(135deg, var(--boost-color), #4a00e0);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(142, 45, 226, 0.4);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .booster-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4a00e0, var(--boost-color));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        .booster-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(142, 45, 226, 0.6);
        }
        .booster-btn:hover::before {
            opacity: 1;
        }
        .booster-btn:disabled {
            opacity: 0;
            height: 0;
            padding: 0;
            margin: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        .booster-btn i {
            font-size: 1.2em;
        }
        .feedback-container {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 600;
            display: none;
            animation: fadeIn 0.5s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .correct-feedback {
            background-color: rgba(0, 176, 155, 0.2);
            color: var(--correct-color);
            border-left: 5px solid var(--correct-color);
        }
        .incorrect-feedback {
            background-color: rgba(255, 65, 108, 0.2);
            color: var(--incorrect-color);
            border-left: 5px solid var(--incorrect-color);
        }
        .result-container {
            text-align: center;
            display: none;
        }
        .restart-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 18px 35px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            box-shadow: 0 10px 25px rgba(106, 17, 203, 0.4);
            position: relative;
            overflow: hidden;
            z-index: 1;
            font-weight: 700;
        }
        .restart-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(106, 17, 203, 0.6);
        }
        .restart-btn:hover::before {
            opacity: 1;
        }
        .restart-btn i {
            margin-right: 10px;
        }
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background-color: #f00;
            top: -10px;
            opacity: 0;
            z-index: 9999;
            animation: confettiFall 5s linear forwards;
        }
        @keyframes confettiFall {
            0% { 
                transform: translateY(0) rotate(0deg) translateX(0);
                opacity: 1;
            }
            100% { 
                transform: translateY(100vh) rotate(720deg) translateX(100px);
                opacity: 0;
            }
        }
        .emoji-float {
            position: fixed;
            font-size: 2em;
            z-index: 9998;
            animation: floatUp 4s linear forwards;
            pointer-events: none;
        }
        @keyframes floatUp {
            0% { 
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% { 
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        .science-icon {
            position: absolute;
            font-size: 1.5em;
            opacity: 0.1;
            z-index: 0;
        }
        @media (max-width: 768px) {
            .quiz-container {
                padding: 25px;
                width: 98%;
            }
            .quiz-header h1 {
                font-size: 2em;
            }
            .question-text {
                font-size: 1.3em;
                padding: 15px;
            }
            .option-btn {
                padding: 15px;
                font-size: 1em;
            }
            .boosters-container {
                flex-direction: column;
                align-items: center;
            }
            .booster-btn {
                width: 100%;
                justify-content: center;
            }
            .stat-value {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container"> <div class="header-nav">
            <a href="games4.html" class="back-dashboard"><i class="fas fa-arrow-left"></i> Volver</a>
            <div class="stats-container">
                <div class="stat-box">
                    <h3>Correctas</h3>
                    <div class="stat-value" id="correct-count">0</div>
                </div>
                <div class="stat-box">
                    <h3>Incorrectas</h3>
                    <div class="stat-value" id="incorrect-count">0</div>
                </div>
            </div>
        </div>


        <div class="quiz-header">
            <h1>Pelicula Extrema</h1>
            <p>Pon a prueba tus conocimientos en peliculas  y gana perlas.</p>
        </div>

        <div class="timer-container">
            <div id="timer-bar" class="timer-bar"></div>
        </div>
        <div class="timer-text" id="timer-text">0:00</div>

        <div class="question-container">
            <div class="question-number" id="question-number">1 / 8</div>
            <h2 class="question-text" id="question-text"></h2>
        </div>

        <div class="options-container" id="options-container">
            </div>

        <div id="feedback-container" class="feedback-container"></div>
        
        <div class="boosters-container">
            <button id="fifty-fifty-booster" class="booster-btn"><i class="fas fa-divide"></i> 50/50</button>
            <button id="time-booster" class="booster-btn"><i class="fas fa-hourglass-half"></i> +30s</button>
        </div>

        <div class="result-container" id="result-container">
            <button id="restart-btn" class="restart-btn"><i class="fas fa-sync-alt"></i> Reiniciar</button>
        </div>
    </div>
   

<script>
    // Todo tu código se ejecuta dentro de este evento.
    // Esto asegura que los scripts de Supabase y SweetAlert2 ya estén cargados.
    document.addEventListener('DOMContentLoaded', function() {
        
      // Tus preguntas de ciencia deben ir aquí
const allScienceQuestions = [
    {
        question: "¿Qué actor protagonizó la película 'Forrest Gump'?",
        options: ["Tom Hanks", "Brad Pitt", "Johnny Depp", "Leonardo DiCaprio"],
        answer: 0,
        explanation: "Tom Hanks ganó el Óscar a Mejor Actor por su papel de Forrest Gump."
    },
    {
        question: "¿Quién es el director de la película 'Pulp Fiction'?",
        options: ["Martin Scorsese", "Steven Spielberg", "Quentin Tarantino", "Alfred Hitchcock"],
        answer: 2,
        explanation: "Quentin Tarantino es conocido por su estilo único en películas como 'Pulp Fiction' y 'Kill Bill'."
    },
    {
        question: "¿Cuál de estas películas de Disney fue la primera en ser un largometraje animado?",
        options: ["La Cenicienta", "El Rey León", "Blancanieves y los siete enanitos", "Bambi"],
        answer: 2,
        explanation: "Blancanieves y los siete enanitos, estrenada en 1937, fue la primera de este tipo."
    },
    {
        question: "¿Qué famoso actor interpretó a Iron Man en el Universo Cinematográfico de Marvel?",
        options: ["Chris Evans", "Robert Downey Jr.", "Chris Hemsworth", "Mark Ruffalo"],
        answer: 1,
        explanation: "Robert Downey Jr. dio vida a Tony Stark, también conocido como Iron Man, durante más de una década."
    },
    {
        question: "¿En qué película el personaje de Rose DeWitt Bukater es interpretado por Kate Winslet?",
        options: ["El Padrino", "Titanic", "El Diario de Noa", "El Mago de Oz"],
        answer: 1,
        explanation: "Kate Winslet interpretó a Rose, la protagonista de 'Titanic', junto a Leonardo DiCaprio."
    },
    {
        question: "¿Qué actriz ganó el Óscar por su papel como una 'reina de belleza' en 'La Favorita'?",
        options: ["Olivia Colman", "Emma Stone", "Rachel Weisz", "Yalitza Aparicio"],
        answer: 0,
        explanation: "Olivia Colman se llevó el Óscar a Mejor Actriz por su brillante interpretación de la Reina Anne."
    },
    {
        question: "¿Cuál es el nombre del famoso agente secreto británico, también conocido como 007?",
        options: ["Ethan Hunt", "Jason Bourne", "James Bond", "Jack Ryan"],
        answer: 2,
        explanation: "James Bond es el nombre del agente de ficción creado por el novelista Ian Fleming."
    },
    {
        question: "La icónica frase '¡Houston, tenemos un problema!' es de la película:",
        options: ["Gravity", "Apollo 13", "Star Wars", "E.T., el extraterrestre"],
        answer: 1,
        explanation: "La frase se hizo famosa en la película 'Apollo 13', protagonizada por Tom Hanks, aunque la versión original es ligeramente diferente."
    },
    {
        question: "¿En qué película Tim Burton dirigió a Johnny Depp en el papel de un hombre con tijeras en lugar de manos?",
        options: ["Sweeney Todd", "Sombras Tenebrosas", "Alicia en el país de las maravillas", "El Joven Manos de Tijera"],
        answer: 3,
        explanation: "El Joven Manos de Tijera fue una de las primeras y más icónicas colaboraciones entre Tim Burton y Johnny Depp."
    },
    {
        question: "¿Qué actor se hizo famoso por su papel como el detective John McClane en la saga de 'Jungla de Cristal'?",
        options: ["Sylvester Stallone", "Arnold Schwarzenegger", "Bruce Willis", "Mel Gibson"],
        answer: 2,
        explanation: "Bruce Willis protagonizó esta exitosa saga de películas de acción, comenzando en 1988."
    },
    {
        question: "¿Quién interpretó a Jack Dawson en 'Titanic'?",
        options: ["Tom Cruise", "Brad Pitt", "Leonardo DiCaprio", "Johnny Depp"],
        answer: 2,
        explanation: "Leonardo DiCaprio interpretó al joven y carismático Jack, enamorado de Rose a bordo del Titanic."
    },
    {
        question: "¿Qué película ganó el Óscar a Mejor Película en 2020?",
        options: ["1917", "Parásitos", "Joker", "El irlandés"],
        answer: 1,
        explanation: "La película surcoreana 'Parásitos' hizo historia al ser la primera película de habla no inglesa en ganar el Óscar a Mejor Película."
    },
    {
        question: "¿Cuál es el apellido de Rocky, el famoso boxeador interpretado por Sylvester Stallone?",
        options: ["Marlow", "Balboa", "Creed", "Tyson"],
        answer: 1,
        explanation: "El nombre completo del personaje es Robert 'Rocky' Balboa, conocido por su apodo 'El semental italiano'."
    },
    {
        question: "¿En qué película de 'Harry Potter' el protagonista asiste al Baile de Navidad?",
        options: ["Harry Potter y la piedra filosofal", "Harry Potter y el prisionero de Azkaban", "Harry Potter y el cáliz de fuego", "Harry Potter y la orden del fénix"],
        answer: 2,
        explanation: "El Baile de Navidad es un evento clave en 'Harry Potter y el cáliz de fuego', parte del Torneo de los Tres Magos."
    },
    {
        question: "Antes de ser actor, ¿a qué se dedicaba Arnold Schwarzenegger?",
        options: ["Luchador de lucha libre", "Fisicoculturista", "Cantante de rock", "Piloto de carreras"],
        answer: 1,
        explanation: "Arnold Schwarzenegger fue un exitoso fisicoculturista antes de convertirse en una estrella de cine y, más tarde, en político."
    },
    {
        question: "¿Qué famoso director es conocido por películas como 'E.T. el Extraterrestre' y 'Jurassic Park'?",
        options: ["James Cameron", "George Lucas", "Steven Spielberg", "Ridley Scott"],
        answer: 2,
        explanation: "Steven Spielberg es uno de los directores más influyentes de la historia del cine, con numerosos éxitos de taquilla."
    }
]; // Variables del juego MEJORADAS
        let currentQuestionIndex = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let timer;
        let timeLeft = 120;
        let gameActive = true;
        let fiftyFiftyUsed = false;
        let timeBoostUsed = false;
        let usedQuestions = [];
        let selectedQuestions = [];

        // Elementos del DOM
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const questionNumber = document.getElementById('question-number');
        const correctCount = document.getElementById('correct-count');
        const incorrectCount = document.getElementById('incorrect-count');
        const timerBar = document.getElementById('timer-bar');
        const timerText = document.getElementById('timer-text');
        const feedbackContainer = document.getElementById('feedback-container');
        const resultContainer = document.getElementById('result-container');
        const restartBtn = document.getElementById('restart-btn');
        const fiftyFiftyBooster = document.getElementById('fifty-fifty-booster');
        const timeBooster = document.getElementById('time-booster');

         // Configuración de Supabase
        const SUPABASE_URL = 'https://fesrphtabjohxcklbosh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlc3JwaHRhYmpvaHhja2xib3NoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMjQ0ODAsImV4cCI6MjA2ODYwMDQ4MH0.S8EJGetv7v9OWfiUCbxvoza1e8yUBVojyWvYCrR5nLo';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      
        async function updatePearls(pearlsToAdd) {
            if (!supabase) {
                console.log('Supabase no está disponible');
                return null;
            }
            // ... (el resto de la función updatePearls es el mismo) ...
            try {
                const { data: { user }, error: authError } = await supabase.auth.getUser();
                
                if (authError || !user) {
                    console.log('Usuario no autenticado');
                    return null;
                }
                
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('perla')
                    .eq('id', user.id)
                    .single();
                
                if (error) throw error;
                
                const currentPearls = profile.perla || 0;
                const newTotal = currentPearls + pearlsToAdd;
                
                const { error: updateError } = await supabase
                    .from('profiles')
                    .update({ perla: newTotal })
                    .eq('id', user.id);
                
                if (updateError) throw updateError;
                
                return newTotal;
            } catch (error) {
                console.error('Error actualizando perlas:', error);
                return null;
            }
        }

        // ... (El resto de tus funciones de juego, como initGame, showQuestion, etc., va aquí) ...

        function initGame() {
            const availableQuestions = allScienceQuestions.filter(q => !usedQuestions.includes(q.question));
            
            if (availableQuestions.length < 11) {
                usedQuestions = [];
            }
            
            selectedQuestions = [...availableQuestions]
                .sort(() => 0.5 - Math.random())
                .slice(0, 8);
            
            selectedQuestions.forEach(q => usedQuestions.push(q.question));
            
            currentQuestionIndex = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            timeLeft = 120;
            gameActive = true;
            fiftyFiftyUsed = false;
            timeBoostUsed = false;
            
            updateStats();
            startTimer();
            showQuestion();
            
            if (resultContainer) resultContainer.style.display = 'none';
            if (feedbackContainer) feedbackContainer.style.display = 'none';
            
            if (fiftyFiftyBooster) {
                fiftyFiftyBooster.style.opacity = '1';
                fiftyFiftyBooster.style.height = 'auto';
                fiftyFiftyBooster.style.padding = '15px 25px';
                fiftyFiftyBooster.style.margin = '0';
                fiftyFiftyBooster.disabled = false;
            }
            
            if (timeBooster) {
                timeBooster.style.opacity = '1';
                timeBooster.style.height = 'auto';
                timeBooster.style.padding = '15px 25px';
                timeBooster.style.margin = '0';
                timeBooster.disabled = false;
            }
            
            createEmoji('🚀', 5);
            createEmoji('🎥', 5);
        }

        function showQuestion() {
            if (currentQuestionIndex >= selectedQuestions.length) {
                endGame();
                return;
            }
            
            const question = selectedQuestions[currentQuestionIndex];
            questionNumber.textContent = currentQuestionIndex + 1;
            questionText.textContent = question.question;
            
            questionText.style.animation = 'none';
            void questionText.offsetWidth; 
            questionText.style.animation = 'fadeIn 0.5s';
            
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.dataset.letter = String.fromCharCode(65 + index);
                optionBtn.textContent = option;
                optionBtn.onclick = () => selectOption(index);
                
                optionBtn.style.animation = `fadeIn 0.3s ${index * 0.1}s forwards`;
                optionBtn.style.opacity = '0';
                
                optionsContainer.appendChild(optionBtn);
            });
            
            if (feedbackContainer) feedbackContainer.style.display = 'none';
            fiftyFiftyUsed = false;
            timeBoostUsed = false;
            
            if (Math.random() > 0.7) {
                createEmoji('🤔', 1);
            }
        }
        
        function selectOption(selectedIndex) {
            if (!gameActive) return;
            
            const question = selectedQuestions[currentQuestionIndex];
            const optionButtons = document.querySelectorAll('.option-btn');
            
            optionButtons.forEach(btn => {
                btn.classList.add('disabled');
                btn.onclick = null;
            });
            
            optionButtons[question.answer].classList.add('correct');
            
            if (selectedIndex === question.answer) {
                optionButtons[selectedIndex].classList.add('correct');
                correctAnswers++;
                
                createConfetti(20);
                createEmoji('🎉', 3);
                createEmoji('👏', 3);
                playSound('correct');
                
                showFeedback('¡BIEN HECHO! 🎯', true);
            } else {
                optionButtons[selectedIndex].classList.add('incorrect');
                incorrectAnswers++;
                
                createEmoji('💥', 2);
                playSound('wrong');
                
                showFeedback(`¡Ups! ${question.explanation}`, false);
            }
            
            updateStats();
            
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < selectedQuestions.length) {
                    showQuestion();
                } else {
                    endGame();
                }
            }, 2000);
        }

        function showFeedback(message, isCorrect) {
            if (!feedbackContainer) return;
            feedbackContainer.textContent = message;
            feedbackContainer.className = 'feedback-container ' + (isCorrect ? 'correct-feedback' : 'incorrect-feedback');
            feedbackContainer.style.display = 'block';
            
            if (!isCorrect) {
                feedbackContainer.style.animation = 'shake 0.5s';
            }
        }

        function updateStats() {
            if (correctCount) correctCount.textContent = correctAnswers;
            if (incorrectCount) incorrectCount.textContent = incorrectAnswers;
            
            if (correctCount && correctAnswers > parseInt(correctCount.dataset.prev || 0)) {
                correctCount.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    correctCount.style.transform = 'scale(1)';
                }, 300);
            }
            if (correctCount) correctCount.dataset.prev = correctAnswers;
        }

        function startTimer() {
            clearInterval(timer);
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            if (!timerText || !timerBar) return;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerText.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            const percentage = (timeLeft / 120) * 100;
            timerBar.style.width = `${percentage}%`;
            
            if (timeLeft <= 10) {
                timerBar.style.background = 'linear-gradient(90deg, #ff416c, #ff4b2b)';
                timerText.style.color = '#ff416c';
                timerText.style.animation = 'pulse 0.5s infinite alternate';
                
                if (timeLeft <= 5 && timeLeft > 0) {
                    createEmoji('⏰', 1);
                    timerText.style.fontWeight = 'bold';
                }
            } else if (timeLeft <= 30) {
                timerBar.style.background = 'linear-gradient(90deg, #ff8a00, #ff416c)';
                timerText.style.color = '#ff8a00';
                timerText.style.animation = 'none';
            } else if (timeLeft <= 60) {
                timerBar.style.background = 'linear-gradient(90deg, #ff8a00, #e52e71)';
                timerText.style.color = '#ff8a00';
            } else {
                timerBar.style.background = 'linear-gradient(90deg, #ff8a00, #ff8a00)';
                timerText.style.color = '#ff8a00';
                timerText.style.animation = 'none';
            }
        }
        
        function timeUp() {
            gameActive = false;
            createEmoji('⌛', 3);
            playSound('timeup');
            endGame();
        }

        async function endGame() {
            gameActive = false;
            clearInterval(timer);
            
            const totalQuestions = selectedQuestions.length;
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            let title, icon, imageUrl, color, message, pearlsToAdd = 0;
            
            if (percentage >= 90) {
                title = "¡ERES UN GENIO! 🌟";
                icon = "success";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/1655/1655698.png";
                color = "#00b09b";
                message = `¡Increíble! Obtuviste <strong>${correctAnswers} de ${totalQuestions}</strong> respuestas correctas.<br><br>¡Tu conocimiento en el cine es asombroso!`;
                pearlsToAdd = 5;
            } else if (percentage >= 70) {
                title = "¡EXCELENTE TRABAJO! 👍";
                icon = "success";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/3163/3163508.png";
                color = "#2575fc";
                message = `¡Muy bien! Acertaste <strong>${correctAnswers} de ${totalQuestions}</strong>.<br><br>¡Estás en el camino para convertirte en un experto en cine!`;
                pearlsToAdd = 4;
            } else if (percentage >= 50) {
                title = "¡BUEN INTENTO! 😊";
                icon = "info";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/1296/1296690.png";
                color = "#ff8a00";
                message = `Obtuviste <strong>${correctAnswers} de ${totalQuestions}</strong> respuestas correctas.<br><br>¡Sigue aprendiendo y mejorarás!`;
                pearlsToAdd = 3;
            } else {
                title = "¡SIGUE PRACTICANDO! 📚";
                icon = "info";
                imageUrl = "https://cdn-icons-png.flaticon.com/128/7342/7342838.png";
                color = "#ff416c";
                message = `Acertaste <strong>${correctAnswers} de ${totalQuestions}</strong>.<br><br>¡Las perliculas  son divertida! Sigue intentándolo.`;
                pearlsToAdd = 1;
            }
            
            const swalOptions = {
                title: title,
                html: `
                    <div style="text-align: center;">
                        <img src="${imageUrl}" style="height: 150px; margin: 10px 0; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <div style="margin: 20px 0; font-size: 1.2em;">
                            ${message}
                        </div>
                        <div style="background: rgba(0,0,0,0.05); border-radius: 10px; padding: 15px; margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="font-weight: bold;">✅ Correctas:</span>
                                <span style="color: #00b09b; font-weight: bold;">${correctAnswers}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-weight: bold;">❌ Incorrectas:</span>
                                <span style="color: #ff416c; font-weight: bold;">${incorrectAnswers}</span>
                            </div>
                            <div style="margin-top: 15px; height: 10px; background: #f5f5f5; border-radius: 5px; overflow: hidden;">
                                <div style="height: 100%; width: ${percentage}%; background: linear-gradient(90deg, ${color}, ${color}); border-radius: 5px;"></div>
                            </div>
                            <div style="margin-top: 5px; font-weight: bold; color: ${color};">${percentage}% de aciertos</div>
                        </div>
                    </div>
                `,
                icon: icon,
                confirmButtonText: '¡Jugar de nuevo!',
                confirmButtonColor: '#6a11cb',
                background: '#ffffff',
                width: '650px',
                customClass: {
                    popup: 'animated bounceIn',
                    title: 'swal-title-custom'
                },
                willOpen: () => {
                    if (percentage >= 80) {
                        createConfetti(50);
                        createEmoji('🎉', 10);
                        createEmoji('🏆', 10);
                        playSound('win');
                    }
                }
            };
            
            try {
                const newPearlCount = await updatePearls(pearlsToAdd);
                
                if (newPearlCount !== null) {
                    swalOptions.html += `
                        <div style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <span style="font-weight: bold;">¡Has ganado:</span>
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 1.5em; margin-right: 5px;">${pearlsToAdd}</span>
                                    <svg width="24" height="24" viewBox="0 0 24 24" style="fill: #8D6E63;">
                                        <circle cx="12" cy="12" r="10" fill="#f5f5f5" stroke="#8D6E63" stroke-width="1"/>
                                        <path d="M12 3a9 9 0 0 1 0 18" stroke="white" stroke-width="1.5" opacity="0.7"/>
                                    </svg>
                                </div>
                            </div>
                            <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                                Total acumulado: <strong>${newPearlCount} perla${newPearlCount !== 1 ? 's' : ''}</strong>
                            </div>
                        </div>
                    `;
                    
                    if (pearlsToAdd > 0) {
                        playSound('coin');
                    }
                }
            } catch (error) {
                console.error('Error al procesar recompensas:', error);
            }
            
            Swal.fire(swalOptions).then((result) => {
                if (result.isConfirmed) {
                    initGame();
                }
            });
        }
        
        if (fiftyFiftyBooster) {
            fiftyFiftyBooster.onclick = function() {
                if (fiftyFiftyUsed || !gameActive) return;
                
                const question = selectedQuestions[currentQuestionIndex];
                const optionButtons = document.querySelectorAll('.option-btn');
                let optionsToHide = [];
                
                for (let i = 0; i < question.options.length; i++) {
                    if (i !== question.answer && optionsToHide.length < 2) {
                        optionsToHide.push(i);
                    }
                }
                
                optionsToHide.forEach(index => {
                    optionButtons[index].style.animation = 'fadeOut 0.3s forwards';
                    setTimeout(() => {
                        optionButtons[index].classList.add('hidden-option');
                    }, 300);
                });
                
                fiftyFiftyUsed = true;
                
                this.style.opacity = '0';
                this.style.height = '0';
                this.style.padding = '0';
                this.style.margin = '0';
                setTimeout(() => {
                    this.disabled = true;
                }, 300);
                
                playSound('booster');
                createEmoji('✨', 2);
                
                Swal.fire({
                    title: '¡POTENCIADOR ACTIVADO!',
                    html: '<div style="font-size: 1.2em;">Se eliminaron <strong>2 respuestas incorrectas</strong> 🎯</div>',
                    icon: 'info',
                    timer: 1500,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    background: '#ffffff',
                    willOpen: () => {
                        createConfetti(10);
                    }
                });
            };
        }

        if (timeBooster) {
            timeBooster.onclick = function() {
                if (timeBoostUsed || !gameActive) return;
                
                timeLeft += 30;
                updateTimerDisplay();
                timeBoostUsed = true;
                
                this.style.opacity = '0';
                this.style.height = '0';
                this.style.padding = '0';
                this.style.margin = '0';
                setTimeout(() => {
                    this.disabled = true;
                }, 300);
                
                createEmoji('⏱️', 2);
                createEmoji('➕', 2);
                playSound('booster');
                
                Swal.fire({
                    title: '¡TIEMPO EXTRA!',
                    html: '<div style="font-size: 1.2em;">+30 segundos añadidos ⏳</div>',
                    icon: 'info',
                    timer: 1500,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    background: '#ffffff'
                });
            };
        }

        function createConfetti(count = 20, isTimeUp = false) {
            const colors = ['#6a11cb', '#2575fc', '#00b09b', '#ff8a00', '#ff416c', '#8e2de2'];
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = confetti.style.width;
                
                if (isTimeUp) {
                    confetti.style.animation = `confettiFall 3s linear ${i * 0.1}s forwards`;
                } else {
                    confetti.style.animation = `confettiFall 5s linear ${i * 0.1}s forwards`;
                }
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        function createEmoji(emoji, count = 1) {
            for (let i = 0; i < count; i++) {
                const emojiElement = document.createElement('div');
                emojiElement.className = 'emoji-float';
                emojiElement.textContent = emoji;
                emojiElement.style.left = `${Math.random() * 80 + 10}%`;
                emojiElement.style.top = `${Math.random() * 50 + 50}%`;
                emojiElement.style.fontSize = `${Math.random() * 2 + 1.5}em`;
                emojiElement.style.animationDuration = `${Math.random() * 3 + 2}s`;
                
                document.body.appendChild(emojiElement);
                
                setTimeout(() => {
                    emojiElement.remove();
                }, 4000);
            }
        }

        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                let frequency, duration;
                
                switch(type) {
                    case 'correct':
                        frequency = 880;
                        duration = 0.3;
                        break;
                    case 'wrong':
                        frequency = 220;
                        duration = 0.5;
                        break;
                    case 'booster':
                        frequency = 523.25;
                        duration = 0.2;
                        break;
                    case 'timeup':
                        frequency = 349.23;
                        duration = 0.5;
                        break;
                    case 'win':
                        playNotes([784, 659, 523, 659, 784, 880], [0, 0.1, 0.2, 0.3, 0.4, 0.5]);
                        return;
                    case 'coin':
                        playNotes([659, 784, 880], [0, 0.1, 0.2]);
                        return;
                    default:
                        frequency = 440;
                        duration = 0.1;
                }
                
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + duration);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log("Error de audio:", e);
            }
        }

        function playNotes(notes, times) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            notes.forEach((note, i) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(note, audioContext.currentTime + times[i]);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + times[i]);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + times[i] + 0.2);
                
                oscillator.start(audioContext.currentTime + times[i]);
                oscillator.stop(audioContext.currentTime + times[i] + 0.2);
            });
        }

        if (restartBtn) {
            restartBtn.onclick = function() {
                createEmoji('🔄', 3);
                initGame();
            };
        }

        // Iniciar juego con SweetAlert2 al cargar la página
        setTimeout(() => {
            Swal.fire({
                title: '¡BIENVENIDO A PELICULA EXTREMA!',
                html: `
                    <div style="font-size: 1.1em;">
                        <p>Responde preguntas sobre peliculas antes de que se acabe el tiempo.</p>
                        <p>¡Usa los potenciadores para ayudarte!</p>
                    </div>
                    <img src="https://cdn-icons-png.flaticon.com/128/9842/9842324.png" style="height: 120px; margin: 15px 0;">
                `,
                confirmButtonText: '¡Comenzar!',
                confirmButtonColor: '#6a11cb',
                background: '#ffffff',
                showCancelButton: false,
                customClass: {
                    popup: 'animated bounceIn'
                },
                willOpen: () => {
                    createConfetti(20);
                }
            }).then(() => {
                initGame();
            });
        }, 500);

    }); // Fin de document.addEventListener('DOMContentLoaded')
</script>
</body>
</html>
